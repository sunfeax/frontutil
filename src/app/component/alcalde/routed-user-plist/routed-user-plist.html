<section class="hero py-5">
  <div class="container">
    <div class="row align-items-center g-4">
      <div class="col-12 col-lg-7">
        <p class="text-uppercase text-primary fw-semibold mb-2">Mi lista de lecturas</p>
        <h1 class="display-5 fw-bold">Seleccion personal de libros que ya he disfrutado</h1>
        <p class="lead text-muted">Cada reseña incluye una valoracion y marca tus favoritos</p>
        <div class="d-flex gap-3 flex-wrap">
          <a class="btn btn-primary" routerLink="/alcalde/plist"><i class="bi bi-gear-fill me-2"></i>Administrar</a>
          <a class="btn btn-outline-light" routerLink="/blog"><i class="bi bi-journal-bookmark me-2"></i>Visitar el blog</a>
        </div>
      </div>
      <div class="col-12 col-lg-5 text-center text-lg-end">
        <div class="hero-card p-4">
          <p class="text-muted mb-1">Filtro rápido de selección</p>
          <div class="row g-2">
            <div class="col-12 col-sm-6">
              <label class="form-label small text-purple">Género</label>
              <select #genreSelect class="form-select" (change)="onGenreChange(genreSelect.value)">
                <option value="Todos">Todos</option>
                @for (genre of genreOptions; track genre) {
                  <option [value]="genre">{{ genre }}</option>
                }
              </select>
            </div>
            <div class="col-12 col-sm-6">
              <label class="form-label small text-purple">Valoración mínima</label>
              <select #ratingSelect class="form-select" (change)="onRatingChange(ratingSelect.value)">
                <option value="0">Todas</option>
                <option value="3">3+</option>
                <option value="4">4+</option>
                <option value="5">5</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="container my-5">
  <div class="featured-accordion" [class.expanded]="featuredExpanded">
    <button class="featured-header w-100 d-flex justify-content-between align-items-center p-3" (click)="toggleFeatured()">
      <div class="d-flex align-items-center gap-3">
        <i class="bi bi-star-fill text-warning fs-4"></i>
        <div class="text-start">
          <p class="text-uppercase text-muted small mb-0">Selección destacada</p>
          <h2 class="h5 mb-0">{{ filteredFeatured.length }} libros recomendados</h2>
        </div>
      </div>
      <div class="d-flex align-items-center gap-3">
        <span class="text-muted small d-none d-sm-inline">{{ featuredExpanded ? 'Ocultar' : 'Ver destacados' }}</span>
        <i class="bi" [class.bi-chevron-down]="!featuredExpanded" [class.bi-chevron-up]="featuredExpanded"></i>
      </div>
    </button>

    @if (featuredExpanded) {
      <div class="featured-content p-3">
        <div class="d-flex justify-content-end align-items-center gap-2 mb-3">
          <label class="text-muted small mb-0">Mostrar:</label>
          <select #featuredLimitSelect class="form-select form-select-sm" style="width: auto;" (change)="onFeaturedLimitChange(featuredLimitSelect.value)">
            <option value="3" [selected]="featuredLimit === 3">3</option>
            <option value="6" [selected]="featuredLimit === 6">6</option>
            <option value="12" [selected]="featuredLimit === 12">12</option>
            <option value="999" [selected]="featuredLimit === 999">Todos</option>
          </select>
          <span class="text-muted small">destacados</span>
        </div>
        @if (loadingFeatured) {
          <div class="text-center py-4">
            <div class="spinner-border"></div>
          </div>
        } @else {
          <div class="row g-4">
            @for (entrada of filteredFeatured; track entrada.id) {
              <div class="col-12">
                <app-alcalde-user-card [entry]="entrada"></app-alcalde-user-card>
              </div>
            }
            @if (!filteredFeatured.length) {
              <div class="col-12">
                <div class="alert alert-info mb-0">No hay libros destacados</div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</section>

<section class="container my-5">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
    <div>
      <p class="text-uppercase text-muted small mb-1">Historico completo</p>
      <h2 class="h4 mb-0">Lecturas publicadas recientemente</h2>
      @if (hasActiveFilters && pagePublished) {
        <p class="text-muted small mb-0 mt-1">
          <i class="bi bi-funnel-fill me-1"></i>{{ pagePublished.totalElements }} lecturas encontradas
        </p>
      }
    </div>
    <div class="d-flex align-items-center gap-2">
      <label class="text-muted small mb-0">Mostrar:</label>
      <select #rppSelect class="form-select form-select-sm" style="width: auto;" (change)="onRppChange(rppSelect.value)">
        <option value="5" [selected]="numRpp === 5">5</option>
        <option value="10" [selected]="numRpp === 10">10</option>
        <option value="20" [selected]="numRpp === 20">20</option>
      </select>
      <span class="text-muted small">por página</span>
    </div>
  </div>

  @if (loadingPage) {
    <div class="text-center py-4">
      <div class="spinner-border"></div>
    </div>
  } @else {
    @if (pagePublished?.content?.length === 0) {
      <div class="alert alert-info text-center">
        <i class="bi bi-search me-2"></i>No hay lecturas que coincidan con los filtros seleccionados
      </div>
    } @else {
      <div class="row g-4">
        @for (entrada of pagePublished?.content; track entrada.id) {
          <div class="col-12">
            <app-alcalde-user-card [entry]="entrada"></app-alcalde-user-card>
          </div>
        }
      </div>
      <div class="d-flex justify-content-center mt-4">
        <app-paginacion [numPage]="numPage" [numPages]="pagePublished?.totalPages || 1" (pageChange)="goToPage($event)"></app-paginacion>
      </div>
    }
  }
</section>
