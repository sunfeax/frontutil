<div class="container py-5">
  
  <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
    
    <div class="card-header bg-white border-0 py-4 px-4 d-flex justify-content-between align-items-center">
      <div>
        <h2 class="mb-1 fw-bold text-primary gradient-text">üìã Listado de Notas</h2>
        <p class="text-muted mb-0 small">Gestiona y organiza tus publicaciones</p>
      </div>
      
      <div class="d-flex gap-2">
        <button class="btn btn-light text-warning fw-semibold shadow-sm" (click)="rellenar()">
          üîÆ Generar 50
        </button>
        <button class="btn btn-primary shadow-sm rounded-pill px-4" [routerLink]="['/pallas/new']">
          <i class="bi bi-plus-lg me-1"></i> Nueva Nota
        </button>
      </div>
    </div>

    @if (strResult) {
      <div class="px-4">
        <div class="alert alert-info border-0 shadow-sm d-flex align-items-center" role="alert">
          <i class="bi bi-info-circle-fill me-2 fs-5"></i>
          <div>{{ strResult }}</div>
        </div>
      </div>
    }

    <div class="card-body p-0">
      
      <div class="px-4 py-3 bg-light bg-opacity-50 border-bottom d-flex justify-content-between align-items-center flex-wrap gap-3">
        
        <span class="badge bg-secondary shadow-sm">
           Total registros: {{ oPage?.totalElements }}
        </span>

        <div class="d-flex align-items-center gap-3">
          
          <div class="input-group shadow-sm" style="width: 250px;">
            <span class="input-group-text bg-white border-end-0 text-muted">
              <i class="bi bi-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control border-start-0 ps-0" 
              placeholder="Buscar..." 
              #txtFilter
              (keyup.enter)="onFilterChange(txtFilter.value)">
            
            <button 
              class="btn btn-outline-secondary" 
              type="button" 
              (click)="onFilterChange(txtFilter.value)">
              Ir
            </button>
          </div>

          <app-botonera-rpp
             [numRpp]="nRpp" 
             (rppChange)="onSetRpp($event)">
          </app-botonera-rpp>

        </div>
      </div>

      @if (filter) {
        <div class="px-4 py-2 bg-warning bg-opacity-10 border-bottom">
          <span class="badge bg-warning text-dark shadow-sm">
            Filtro activo: "{{ filter }}"
            <i class="bi bi-x-circle ms-2 pointer text-danger" 
               style="cursor: pointer" 
               title="Quitar filtro"
               (click)="onFilterChange(''); txtFilter.value=''"></i>
          </span>
        </div>
      }

      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light">
            <tr>
              <th class="ps-4 text-uppercase text-secondary text-xs font-weight-bolder opacity-7" style="width: 5%">ID</th>
              <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7" style="width: 20%">T√≠tulo</th>
              <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7" style="width: 25%">Contenido</th>
              <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
              <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Creaci√≥n</th>
              <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Modificaci√≥n</th>
              <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Acciones</th>
            </tr>
          </thead>
          <tbody>
            
            @for (nota of oPage?.content; track nota.id) {
              <tr>
                <td class="ps-4 fw-bold text-muted">#{{ nota.id }}</td>
                
                <td>
                  <div class="d-flex flex-column">
                    <span class="fw-bold text-dark">{{ nota.titulo }}</span>
                  </div>
                </td>
                
                <td>
                  <span class="text-muted text-truncate d-inline-block" style="max-width: 200px;">
                    {{ nota.contenido }}
                  </span>
                </td>
                
                <td class="text-center">
                  @if (nota.publicado) {
                    <span class="badge rounded-pill bg-success-subtle text-success border border-success-subtle px-3">
                      Publicado
                    </span>
                  } @else {
                    <span class="badge rounded-pill bg-danger-subtle text-danger border border-danger-subtle px-3">
                      Borrador
                    </span>
                  }
                </td>
                
                <td class="small text-secondary">
                  <i class="bi bi-calendar-event me-1"></i>
                  {{ nota.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}
                </td>
                
                <td class="small text-secondary">
                  @if (nota.fechaModificacion) {
                    <i class="bi bi-pencil me-1"></i>
                    {{ nota.fechaModificacion | date:'dd/MM/yyyy HH:mm' }}
                  } @else {
                    <span class="text-muted fst-italic opacity-50">--</span>
                  }
                </td>
            
                <td class="text-center">
                  <div class="btn-group shadow-sm rounded-3" role="group">
                    <button type="button" class="btn btn-sm btn-outline-secondary border-0" 
                            [routerLink]="['/pallas/view', nota.id]" title="Ver">
                      üëÅÔ∏è
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary border-0" 
                            [routerLink]="['/pallas/edit', nota.id]" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" 
                            [routerLink]="['/pallas/remove', nota.id]" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </div>
                </td>

                <td class="text-center">
  <button class="btn btn-sm rounded-pill px-3 border" 
          [class.btn-success-subtle]="nota.publicado"
          [class.text-success]="nota.publicado"
          [class.border-success-subtle]="nota.publicado"
          [class.btn-danger-subtle]="!nota.publicado"
          [class.text-danger]="!nota.publicado"
          [class.border-danger-subtle]="!nota.publicado"
          (click)="togglePublicado(nota)">
    
    @if (nota.publicado) {
      <i class="bi bi-check-circle-fill me-1"></i> Publicado
    } @else {
      <i class="bi bi-pause-circle-fill me-1"></i> Borrador
    }
  </button>
</td>
              </tr>
            } 
            
            @if (!oPage || oPage.content.length === 0) {
              <tr>
                <td colspan="7" class="text-center py-5">
                  <div class="d-flex flex-column align-items-center opacity-50">
                    <i class="bi bi-folder-x fs-1 mb-2"></i>
                    <h5>No se encontraron resultados</h5>
                    <p class="small">
                      @if(filter) {
                        Prueba con otra palabra clave o limpia el filtro.
                      } @else {
                        ¬°Prueba a generar 50 notas nuevas!
                      }
                    </p>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="card-footer bg-white border-0 py-3">
      <div class="d-flex justify-content-center">
        <app-paginacion 
            [numPage]="oPage ? oPage.number : 0"
            [numPages]="oPage ? oPage.totalPages : 0"
            (pageChange)="onSetPage($event)">
        </app-paginacion>
      </div>
    </div>

  </div>
</div>